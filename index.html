<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ìŒì•… ì¬ìƒ ì‚¬ì´íŠ¸</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#7c3aed;--muted:#98a6b3;--glass:rgba(255,255,255,0.04)}
    *{box-sizing:border-box}
    body{font-family:Inter,system-ui,Segoe UI,Roboto,'Noto Sans KR',sans-serif;margin:0;min-height:100vh;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,#071028 0%,#071420 100%);color:#e6eef8;overflow:hidden}
    .wrap{width:min(1080px,96%);background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border-radius:12px;padding:20px;box-shadow:0 8px 30px rgba(2,6,23,0.7);display:grid;grid-template-columns:360px 1fr;gap:18px;position:relative}
    .background-image{position:absolute;inset:0;background:url('https://images.unsplash.com/photo-1507874457470-272b3c8d8ee2?auto=format&fit=crop&w=1280&q=80') center/cover no-repeat;filter:brightness(0.25) blur(6px);z-index:-1;transition:transform 5s ease;}
    .panel{background:var(--card);border-radius:10px;padding:14px;backdrop-filter:blur(10px)}
    .library{display:flex;flex-direction:column;gap:12px}
    .cover{width:100%;aspect-ratio:1/1;border-radius:8px;background:linear-gradient(120deg,#0f1724,#061428);display:flex;align-items:center;justify-content:center;color:var(--muted);font-size:13px;overflow:hidden}
    .cover img{width:100%;height:100%;object-fit:cover;border-radius:8px;transition:transform 0.3s ease;}
    .meta{margin-top:10px}
    .title{font-weight:600;cursor:pointer}
    .title.editing{background:rgba(255,255,255,0.08);padding:2px 5px;border-radius:4px;}
    .artist{color:var(--muted);font-size:13px}
    .controls{display:flex;gap:8px;align-items:center;margin-top:12px}
    button{background:var(--glass);color:inherit;border:1px solid rgba(255,255,255,0.03);padding:10px;border-radius:8px;cursor:pointer}
    button.large{padding:14px;border-radius:10px}
    .playback{display:flex;flex-direction:column;gap:12px}
    .progress{height:8px;background:rgba(255,255,255,0.04);border-radius:6px;position:relative;overflow:hidden}
    .progress > i{position:absolute;left:0;top:0;bottom:0;width:0;background:linear-gradient(90deg,var(--accent),#00d4ff)}
    .time{display:flex;justify-content:space-between;color:var(--muted);font-size:12px}
    .playlist{display:flex;flex-direction:column;gap:6px;max-height:360px;overflow:auto;padding-right:6px}
    .track{display:flex;align-items:center;gap:10px;padding:8px;border-radius:8px;cursor:pointer}
    .track:hover{background:rgba(255,255,255,0.02)}
    .track .dot{width:10px;height:10px;border-radius:50%;background:rgba(255,255,255,0.06)}
    .track.active{background:linear-gradient(90deg,rgba(124,58,237,0.12),rgba(0,212,255,0.06));outline:1px solid rgba(124,58,237,0.12)}
    .file-controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    .bottom-row{display:flex;justify-content:space-between;align-items:center;margin-top:12px}
    input[type=range]{width:160px}
    @media(max-width:800px){.wrap{grid-template-columns:1fr;}}
  </style>
</head>
<body>
  <div class="background-image" id="bg"></div>
  <main class="wrap">
    <section class="panel">
      <div class="library">
        <div class="cover" id="cover"><img id="cover-img" src="https://images.unsplash.com/photo-1507874457470-272b3c8d8ee2?auto=format&fit=crop&w=500&q=60" alt="ì•¨ë²” ì»¤ë²„"></div>
        <div class="meta">
          <div class="title" id="track-title">ì„ íƒëœ íŠ¸ë™ ì—†ìŒ</div>
          <div class="artist" id="track-artist">ì œëª© ëˆ„ë¥´ë©´ ì œëª© ë³€ê²½ ã„±ã„´</div>
        </div>

        <div class="controls">
          <button id="prevBtn">â® ì´ì „ë…¸ë˜</button>
          <button id="playBtn" class="large">â–¶ ì¼ì‹œì •ì§€</button>
          <button id="nextBtn">â­ ë‹¤ìŒ ë…¸ë˜</button>
          <button id="shuffleBtn">ì²©</button>
          <button id="loopBtn">ì»´í¼ë‹ˆ!!</button>
        </div>

        <div class="file-controls">
          <input type="file" id="fileInput" accept="audio/*" multiple style="display:none;">
          <button id="addFileBtn">+ íŒŒì¼ë¡œ ì¶”ê°€</button>
          <button id="addUrlBtn">+ URL/ìœ íŠœë¸Œ ì¶”ê°€</button>
          <button id="clearBtn">ëª©ë¡ ì§€ìš°ê¸°</button>
        </div>

        <div style="margin-top:10px">
          <div class="progress" id="progressBar" title="ì¬ìƒ ì§„í–‰">
            <i></i>
          </div>
          <div class="time"><span id="curTime">00:00</span><span id="durTime">00:00</span></div>
        </div>

        <div class="bottom-row">
          <div style="display:flex;align-items:center;gap:8px">
            <label for="vol">ğŸ”Š</label>
            <input id="vol" type="range" min="0" max="1" step="0.01" value="1">
          </div>
          <div style="font-size:12px;color:var(--muted)">í—¤ë¥´ë©”ìŠ¤ ìŒì•… ì‚¬ì´íŠ¸</div>
        </div>
      </div>
    </section>

    <section class="panel playback">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h3 style="margin:0">ì¬ìƒëª©ë¡</h3>
        <small style="color:var(--muted)">íŒŒì¼ ë˜ëŠ” ìœ íŠœë¸Œ URLë¡œ ì¶”ê°€ ê°€ëŠ¥</small>
      </div>

      <div class="playlist" id="playlist"></div>
      <p style="color:var(--muted);font-size:13px;margin-top:10px">ìë™ìœ¼ë¡œ ìë™ì¬ìƒ ê¶ê¸ˆí•œ ê±° ìˆìœ¼ë©´ ì´ë°• ê° ìœ¼ë¡œ ë¬¸ì˜</p>
    </section>
  </main>

  <audio id="audio" preload="auto" autoplay></audio>

  <script>
    const audio = document.getElementById('audio');
    const playBtn = document.getElementById('playBtn');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const shuffleBtn = document.getElementById('shuffleBtn');
    const loopBtn = document.getElementById('loopBtn');
    const vol = document.getElementById('vol');
    const progressBar = document.getElementById('progressBar');
    const progressFill = progressBar.querySelector('i');
    const bg = document.getElementById('bg');

    const coverImg = document.getElementById('cover-img');
    const trackTitle = document.getElementById('track-title');
    const trackArtist = document.getElementById('track-artist');
    const playlistEl = document.getElementById('playlist');
    const curTimeEl = document.getElementById('curTime');
    const durTimeEl = document.getElementById('durTime');

    const addUrlBtn = document.getElementById('addUrlBtn');
    const clearBtn = document.getElementById('clearBtn');
    const addFileBtn = document.getElementById('addFileBtn');
    const fileInput = document.getElementById('fileInput');

    let tracks = [];
    let idx = 0;
    let isShuffle = false;

    function formatTime(s){
      if(isNaN(s)) return '00:00';
      const m = Math.floor(s/60).toString().padStart(2,'0');
      const sec = Math.floor(s%60).toString().padStart(2,'0');
      return `${m}:${sec}`;
    }

    function renderPlaylist(){
      playlistEl.innerHTML='';
      tracks.forEach((t,i)=>{
        const el = document.createElement('div');
        el.className='track'+(i===idx?' active':'');
        el.innerHTML = `<div style="display:flex;align-items:center;gap:10px"><div class='dot'></div><div><div style='font-weight:600'>${t.title}</div><div style='font-size:12px;color:var(--muted)'>${t.artist||''}</div></div></div>`;
        el.addEventListener('click',()=>{idx=i;loadTrack(idx);play();renderPlaylist();});
        playlistEl.appendChild(el);
      });
    }

    function loadTrack(i){
      if(!tracks[i]) return;
      const t = tracks[i];
      audio.src = t.src;
      trackTitle.textContent = t.title;
      trackArtist.textContent = t.artist || 'ìŒì•… íŒŒì¼';
      coverImg.src = t.cover || 'https://images.unsplash.com/photo-1507874457470-272b3c8d8ee2?auto=format&fit=crop&w=500&q=60';
      bg.style.backgroundImage = `url('${coverImg.src}')`;
      bg.style.transform = `scale(1.05) translate(${Math.random()*10-5}px, ${Math.random()*10-5}px)`;
    }

    function play(){
      audio.play().then(()=>{playBtn.textContent='â¸ï¸'}).catch(()=>{playBtn.textContent='â–¶ï¸'});
    }
    function pause(){audio.pause();playBtn.textContent='â–¶ï¸'}

    playBtn.addEventListener('click',()=>{audio.paused?play():pause();});
    prevBtn.addEventListener('click',()=>{idx=(idx-1+tracks.length)%tracks.length;loadTrack(idx);play();renderPlaylist();});
    nextBtn.addEventListener('click',()=>{idx=(idx+1)%tracks.length;loadTrack(idx);play();renderPlaylist();});

    shuffleBtn.addEventListener('click',()=>{isShuffle=!isShuffle;shuffleBtn.style.opacity=isShuffle?1:0.6;});
    loopBtn.addEventListener('click',()=>{audio.loop=!audio.loop;loopBtn.style.opacity=audio.loop?1:0.6;});
    vol.addEventListener('input',()=>{audio.volume=Number(vol.value);});

    audio.addEventListener('timeupdate',()=>{
      const pct=audio.currentTime/(audio.duration||1)*100;
      progressFill.style.width=pct+'%';
      curTimeEl.textContent=formatTime(audio.currentTime);
      durTimeEl.textContent=formatTime(audio.duration);
      coverImg.style.transform = `scale(${1 + Math.sin(audio.currentTime*2)*0.02})`;
      bg.style.transform = `translate(${Math.sin(audio.currentTime*0.5)*5}px, ${Math.cos(audio.currentTime*0.5)*5}px) scale(1.05)`;
    });

    progressBar.addEventListener('click',(e)=>{
      const rect=progressBar.getBoundingClientRect();
      const x=e.clientX-rect.left;
      const pct=x/rect.width;
      audio.currentTime=pct*(audio.duration||0);
    });

    audio.addEventListener('ended',()=>{
      if(isShuffle){idx=Math.floor(Math.random()*tracks.length);}else{idx=(idx+1)%tracks.length;}
      loadTrack(idx);play();renderPlaylist();
    });

    addFileBtn.addEventListener('click',()=>fileInput.click());
    fileInput.addEventListener('change',(e)=>{
      const files=[...e.target.files];
      files.forEach(f=>{
        const url=URL.createObjectURL(f);
        tracks.push({title:f.name,artist:'ì´ë°• ë§Œì„¸',src:url});
      });
      renderPlaylist();
      if(tracks.length===files.length){loadTrack(0);play();}
    });

    addUrlBtn.addEventListener('click',()=>{
      const url=prompt('ì´ê±° ì–´ì°¨í”¼ ì•ˆë˜ë‹ˆê¹Œ "https://ko.onlymp3.io/convert/5_n6t9G2TUQ"ë¡œ ì ‘ì†í•´ì„œ íŒŒì¼ë¡œ ë­”ë§ì•Œ?');
      if(url){
        const name=url.split('/').pop().split('?')[0];
        tracks.push({title:name,artist:'URL ìŒì•…',src:url});
        renderPlaylist();
        if(tracks.length===1){loadTrack(0);play();}
      }
    });

    clearBtn.addEventListener('click',()=>{
      if(!confirm('ëª©ë¡ì„ ëª¨ë‘ ì§€ìš¸ê¹Œìš”?'))return;
      tracks=[];idx=0;audio.pause();audio.src='';renderPlaylist();
    });

    document.addEventListener('keydown',(e)=>{
      if(e.target.tagName === 'INPUT' || e.target.isContentEditable) return;
      if(e.code === 'Space'){ e.preventDefault(); audio.paused?play():pause(); }
      if(e.code === 'ArrowRight'){ audio.currentTime = Math.min(audio.duration, audio.currentTime + 10); }
      if(e.code === 'ArrowLeft'){ audio.currentTime = Math.max(0, audio.currentTime - 10); }
    });

    trackTitle.addEventListener('click',()=>{
      if(trackTitle.contentEditable === "true") return;
      trackTitle.contentEditable = "true";
      trackTitle.classList.add('editing');
      trackTitle.focus();
      const range = document.createRange();
      range.selectNodeContents(trackTitle);
      const sel = window.getSelection();
      sel.removeAllRanges(); sel.addRange(range);
    });

    trackTitle.addEventListener('keydown',(e)=>{
      if(e.key === 'Enter'){
        e.preventDefault();
        tracks[idx].title = trackTitle.textContent.trim();
        trackTitle.contentEditable = "false";
        trackTitle.classList.remove('editing');
        renderPlaylist();
      }
      if(e.key === 'Escape'){
        e.preventDefault();
        trackTitle.textContent = tracks[idx].title;
        trackTitle.contentEditable = "false";
        trackTitle.classList.remove('editing');
      }
    });

    renderPlaylist();
  </script>
</body>
</html>